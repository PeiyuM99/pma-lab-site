---
import { getCollection } from 'astro:content';
import PageLayout from '../layouts/PageLayout.astro';

const projects = (await getCollection('projects')).sort((a, b) => a.data.order - b.data.order);
const base = import.meta.env.BASE_URL;
const toAssetUrl = (p: string) => (p.startsWith('http') ? p : `${base}${p.replace(/^\//, '')}`);
---

<PageLayout title="Projects">
  <section class="project-shell">
    <h1>Projects</h1>

    <div class="project-grid">
      {projects.map((p) => (
        <a class="project-card" href={`${base}projects/${p.slug}/`}>
          <img src={toAssetUrl(p.data.image)} alt={`${p.data.name} image`} />
          <div class="card-body">
            <h2>{p.data.name}</h2>
            <p>{p.data.summary}</p>
          </div>
        </a>
      ))}
    </div>
  </section>
</PageLayout>

<style>
  :global(main) {
    width: min(1800px, calc(100% - 2rem));
    max-width: 1800px;
  }

  .project-shell { width: 100%; }

  .project-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1.25rem;
  }

  .project-card {
    display: grid;
    grid-template-columns: 40% 1fr;
    gap: 1rem;
    border: 1px solid #e3e8f2;
    border-radius: 12px;
    padding: 0.9rem;
    background: #fff;
    text-decoration: none;
    color: inherit;
  }

  .project-card img {
    width: 100%;
    aspect-ratio: 4 / 3;
    object-fit: cover;
    border-radius: 10px;
    border: 1px solid #d7e1f0;
  }

  .card-body h2 {
    font-size: 1.3rem;
    margin-bottom: 0.4rem;
  }

  .card-body p {
    margin: 0;
    line-height: 1.6;
  }

  @media (max-width: 1100px) {
    .project-grid { grid-template-columns: 1fr; }
  }

  @media (max-width: 720px) {
    .project-card {
      grid-template-columns: 1fr;
    }
  }
</style>
